---
title: "Covid91 vaccine study Final2025"
author: "Aetan Barquero"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
F = filter(FinalData, sex =="F")
M = filter(FinalData, sex =="M")
gay = filter(FinalData, LGBTQ =="gay")
Druguser = filter(FinalData, DrugUser =="yes")
```


Seperating the variables into four different categories (M=Male, F=Female, gay, and drug users) was imperent as this allows the data to be correctly analyzed. The seperation of these variables also allows understanding if one should take the Covid-19 vaccine. 

# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

## Males

### Barplot

```{r}
dd2 <- M %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```


The plot above displays the population of male people the if they caught and took the vaccine or had a placebo.

Among all the males who caught Covid, the ones who took the placebo are approximately around 75% and the men who took the vaccine was exceedingly small around 25%. Of the people who did fine, it was split 50/50 between people who took the placebo vs. the people who had the vaccine. 

The barplots were generated using three main objects: dd2, basicC, and basicCC. The first object, dd2, appears in the Environment pane and contains four variables: treatment, infected, count, and prcnt (representing percent). This dataset is created using group_by() and summarize() to count the number of observations in each treatment–infection group, followed by mutate() to calculate the corresponding proportions.

The second object, basicC, also visible in the Environment pane, includes 11 variables and is used to create the first barplot that displays raw counts across groups. The final object, basicCC, located in the Files pane, also contains 11 variables and is used to generate the second barplot, which visualizes the percentages of infected individuals by treatment group.

### Numerical 

```{r}
table1 <- xtabs(~infected + treatment, data=M)
rowPerc(table1)
colPerc(table1)
```

These numerical results summarize the percentages of males who became infected with COVID-19 after receiving either the placebo or the vaccine. Among those who contracted COVID-19, 73.80% had taken the placebo, while only 26.20% had taken the vaccine, indicating a noticeable reduction in infections among vaccinated individuals. For the males who remained healthy, the percentages were nearly evenly split: 50.01% of the placebo group and 49.99% of the vaccine group were not infected. Overall, these results suggest that the vaccine is effective for males, as the proportion of infections is much lower among those who received the vaccine compared with the placebo group.

### Inferential

```{r}
chisq.test(table1)
chisqtestGC(table1)
Msfish <- fisher.test(table1)
Msfish
```

The test produced an extremely small p-value (< 2.2×10⁻¹⁶), which is effectively zero. Such a tiny p-value indicates that the observed differences are highly unlikely to be due to chance alone.

As a result, we have strong evidence to reject the null hypothesis that COVID-19 infection status is independent of treatment group. In other words, infection rates differ significantly between the placebo and vaccine groups.

The estimated odds ratio is 2.82, meaning that individuals who received the placebo were nearly three times more likely to become infected with COVID-19 compared to those who received the vaccine. This represents a substantial difference and provides strong evidence that the vaccine is effective.

```{r}
effect <- Msfish$p.value/(Msfish$p.value +1)
effectivenessM = Msfish$estimate/(Msfish$estimate +1)*100
print(effectivenessM)
```

```{r}
low=(Msfish$conf.int[1]/(Msfish$conf.int[1] +1))*100
hi=(Msfish$conf.int[2]/(Msfish$conf.int[2] +1))*100
options(digits=2)
```

The results above show the estimated effectiveness of the COVID-19 vaccine for males. Since an effectiveness value above 50% indicates that the vaccine provides meaningful protection, the values calculated here suggest that the vaccine is effective in reducing the risk of COVID-19 infection among males.

The odds ratio provides another way to express vaccine effectiveness. For males, the estimated effectiveness is about 73.8%, and the corresponding confidence interval ranges from approximately 68.85% to 78.32%. This interval indicates that, with high confidence, the vaccine offers substantial protection.

## Females

### Barplot

```{r}
dd2 <- F %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

The first bar graph presents the number of females who got Covid-19 versus those who did not, separated by whether they received the vaccine or the placebo. The second graph shows the percentage of females in each group—whether they were infected or not—based on whether they took the vaccine or the placebo.

From the plot, about 65% of the females who contracted Covid-19 had received the placebo, while about 35% had received the vaccine. Among the females who did not contract Covid-19, the distribution is close to 50/50 between the vaccine and placebo groups. Compared to male participants, this suggests that fewer females contracted Covid-19 with the placebo, and more contracted Covid-19 with the vaccine. Still, the same general pattern appears: the placebo group shows a higher infection rate than the vaccine group.

The R code used to create the barplot begins with the line starting with dd2. The dd2 dataset includes four variables: treatment, infected, count, and prcnt (percentage). The first graph is generated using the code labeled basicC, which uses the 11 variables stored in the environment panel. The final block of code—also named basicCC—uses these variables to create the percentage barplot shown in the second graph.

### Numerical 

```{r}
table1 <- xtabs(~infected + treatment, data=F)
rowPerc(table1)
colPerc(table1)
```

Among the females who became infected, 65% had taken the placebo, while only 35% had received the vaccine. For those who did not get Covid-19, the percentages were evenly split with 50% taking the placebo and 50% taking the vaccine. These findings indicate that the Covid-19 vaccine was effective for females, as a smaller proportion of vaccinated women contracted the virus compared to those who received the placebo. This difference is notable and highlights the vaccine’s impact.

### Inferential 

```{r}
chisq.test(table1)
chisqtestGC(table1)
Fsfish <- fisher.test(table1)
Fsfish
```

The most important part of these results comes from the Fisher’s Exact Test. The p-value is extremely small—close to 0—which means that the results are very unlikely to be due to chance.

Because of this, we can reject the null hypothesis. In other words, being infected with Covid-19 is not independent of the treatment group. The treatment someone received (placebo or vaccine) is related to whether they got Covid-19.

The odds ratio is 1.9, meaning that females who took the placebo were almost twice as likely to get Covid-19 compared to those who received the vaccine. This is a meaningful difference and supports the conclusion that the vaccine is likely effective.

```{r}
effect <- Fsfish$p.value/(Fsfish$p.value +1)
effectivenessF = Fsfish$estimate/(Fsfish$estimate +1)*100
print(effectivenessF)
```

```{r}
low=(Fsfish$conf.int[1]/(Fsfish$conf.int[1] +1))*100
hi=(Fsfish$conf.int[2]/(Fsfish$conf.int[2] +1))*100
options(digits=2)
```

The section above shows the effectiveness of the COVID-19 vaccine for females. If the effectiveness is higher than 50%, it means the vaccine is doing its job. Based on the confidence interval shown, we can say that the vaccine is effective at protecting females from getting COVID-19. Even though it may not be as effective as it is for males, it still provides strong protection.

The odds ratio gives us an idea of how effective the vaccine is. For females, the odds ratio is about 65. The confidence interval for effectiveness ranges from about 59.8 to 69.92.

## LGBTQ

### Barplot

```{r}
dd2 <- gay %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot shows a group of gay people and the relationship between getting COVID-19 and whether they received the vaccine or a placebo.

The first bar graph shows how many people got COVID-19 or stayed healthy, and whether they took the placebo or the vaccine. The second graph shows the percentage of people who took the placebo or the vaccine, and whether they got COVID-19 or not. Both graphs separate the people into groups based on whether they were infected and which treatment they received.

Among the people who caught COVID-19, the group that took the placebo had a very high bar—around 80%. The group that took the vaccine had a much smaller bar, around 20%. Of the people who did not get COVID-19, about 48% had taken the placebo, while about 52% had taken the vaccine. This shows that, in this sample of gay people, those who took the placebo caught COVID-19 much more often than those who were vaccinated.

The code used to make this barplot starts with the dataset named dd2. This dataset has four variables: treatment, infected, count, and prcnt. The first graph is created using the code named basicC, which is shown in the environment pane and contains 11 variables that help build the plot. The second graph uses the same code structure but displays percentages instead of counts.

### Numerical Results

```{r}
table1 <- xtabs(~infected + treatment, data=gay)
rowPerc(table1)
colPerc(table1)
```

These numbers show the real percentages of people in the study who got COVID-19 after taking either the placebo or the vaccine.

The results match the estimates from the bar plot. A large percentage — 80% — of the people who took the placebo got COVID-19. In comparison, only 20% of the people who took the vaccine got COVID-19. Of the people who stayed healthy, 48% were from the placebo group and 52% were from the vaccine group. This shows that the COVID-19 vaccine is effective, because only a small portion of the vaccinated group got sick. People who took the placebo got COVID-19 much more often. This difference is important.

### Inferential Results 

```{r}
chisq.test(table1)
chisqtestGC(table1)
gaysfish <- fisher.test(table1)
gaysfish
```

The p-value is extremely small (0.0000007). This means the results are very unlikely to be due to chance.

Because of this, we strongly reject the null hypothesis that getting COVID-19 is independent of sex.

The odds ratio is 4.3. This means that people who took the placebo were about 4 times more likely to get COVID-19 than people who took the vaccine. This is a very important difference. It also shows that the vaccine is very likely effective. The odds ratio is larger for both males and females.

```{r}
effect <- gaysfish$p.value/(gaysfish$p.value +1)
effectivenessgays = gaysfish$estimate/(gaysfish$estimate +1)*100
print(effectivenessgays)
```

```{r}
low=(gaysfish$conf.int[1]/(gaysfish$conf.int[1] +1))*100
hi=(gaysfish$conf.int[2]/(gaysfish$conf.int[2] +1))*100
options(digits=2)
```

The section above shows the effectiveness of the COVID-19 vaccine for this group. If the effectiveness is above 50%, it means the vaccine works. Based on the interval shown, we can say the vaccine is very effective in protecting this group from getting COVID-19.

The odds ratio also helps show how effective the vaccine is. For this group, the odds ratio is about 81. The confidence interval for effectiveness is roughly 69 to 89.88.

## Druggies

### Barplot

```{r}
dd2 <-  Druguser %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

The first graph displays the number of people who either got Covid or stayed healthy, and whether they received the vaccine or the placebo. The second graph shows the percentage of people in each group—placebo or vaccine—who did or did not get Covid. Both graphs divide people based on two things: whether they caught Covid and whether they took the vaccine or the placebo.

Among the people who caught Covid, the group that took the placebo was much smaller, making up about 11%, while the group that took the vaccine made up about 89%. For the people who did not get Covid, the split was about 52% for those who took the placebo and about 48% for those who received the vaccine.

The barplot was created using code that starts with the chunk named dd2. In the environment panel, dd2 can be seen holding four variables: treatment, infected, count, and prcent (short for percent). The second group of code is called basicC, which appears in the environment panel as well and includes a list of 11 variables. This section helps create the first plot. The last chunk of code is basicC$, found in the files pane. It contains the variables used to make the percentage plot, which is the second graph.


### Numerical 

```{r}
table1 <- xtabs(~infected + treatment, data= Druguser)
rowPerc(table1)
colPerc(table1)
```

These numerical results show the actual percentages of drug users who got Covid-19 after taking either the placebo or the vaccine.

Only about 8.3% of the drug users who took the placebo got Covid-19, which is a very small amount. In contrast, 91.7% of the people who took the vaccine got Covid-19, which is a very large percentage. Among the people who did not get Covid, 51% of the placebo group stayed healthy, and 49% of the vaccine group stayed healthy.

These numbers suggest that the Covid-19 vaccine was not effective for this group of drug users, since 91.7% of the vaccinated group still got Covid-19. Meanwhile, the placebo group had a much lower percentage of infections.

### Inferential 

```{r}
chisq.test(table1)
chisqtestGC(table1)
drugfish <- fisher.test(table1)
drugfish
```

The p-value is extremely small (0.000000000003). This means the results are very unlikely to be due to chance.

Because of this, we reject the null hypothesis and accept the alternative.

The odds ratio is 0.087. This means that people who took the placebo were about 0.087 times more likely to get COVID-19 than those who got the vaccine. This is a very strong difference and suggests that the vaccine is likely not effective.

```{r}
effect <- drugfish$p.value/(drugfish$p.value +1)
effectivenessdrug = drugfish$estimate/(drugfish$estimate +1)*100
print(effectivenessdrug)
```

```{r}
low=(drugfish$conf.int[1]/(drugfish$conf.int[1] +1))*100
hi=(drugfish$conf.int[2]/(drugfish$conf.int[2] +1))*100
options(digits=2)
```

The section above shows the effectiveness of the COVID-19 vaccine for drug users. It’s important to know that an effectiveness above 50% would mean the vaccine works. Based on the interval shown, we can conclude that the vaccine is not effective at protecting drug users from getting COVID-19.

The odds ratio gives another view of the vaccine’s effectiveness. For drug users, the odds ratio is about 8.04. The confidence interval for effectiveness ranges from about 2.65 to 17.86. These values show that the vaccine is not effective for this group.

# Overall Results and Conclusions

Covid-19 vaccination was fairly effective in protecting men from catching the virus. Their effectiveness rate was 73.8%, with a confidence interval of about 68.85 to 78.32.

The vaccine was also effective for women. Their effectiveness rate was 65%, and the confidence interval was roughly 59.8 to 69.92.

The vaccine appeared most effective for gay participants, with an effectiveness rate of 81% and a confidence interval of about 69 to 89.88.

However, the vaccine was not effective for drug users. Their effectiveness rate was only 8.04%, and the confidence interval was around 2.65 to 17.86. This suggests the vaccine did not work well for this group.

In conclusion, the vaccine was highly effective for gay participants and men, and reasonably effective for women. It is not recommended for drug users based on these results.