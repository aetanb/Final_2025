---
title: "Covid91 vaccine study Final2025"
author: "Aetan Barquero"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
F = filter(FinalData, sex =="F")
M = filter(FinalData, sex =="M")
gay = filter(FinalData, LGBTQ =="gay")
Druguser = filter(FinalData, DrugUser =="yes")
```


Seperating the variables into four different categories (M=Male, F=Female, gay, and drug users) was imperent as this allows the data to be correctly analyzed. The seperation of these variables also allows understanding if one should take the Covid-19 vaccine. 

# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

## Males


```{r}
dd2 <- M %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```


The plot above displays the population of male people the if they caught and took the vaccine or had a placebo.

Among all the males who caught Covid, the ones who took the placebo are approximately around 75% and the men who took the vaccine was exceedingly small around 25%. Of the people who did fine, it was split 50/50 between people who took the placebo vs. the people who had the vaccine. 

The barplots were generated using three main objects: dd2, basicC, and basicCC. The first object, dd2, appears in the Environment pane and contains four variables: treatment, infected, count, and prcnt (representing percent). This dataset is created using group_by() and summarize() to count the number of observations in each treatment–infection group, followed by mutate() to calculate the corresponding proportions.

The second object, basicC, also visible in the Environment pane, includes 11 variables and is used to create the first barplot that displays raw counts across groups. The final object, basicCC, located in the Files pane, also contains 11 variables and is used to generate the second barplot, which visualizes the percentages of infected individuals by treatment group.

### Numerical 

```{r}
table1 <- xtabs(~infected + treatment, data=M)
rowPerc(table1)
colPerc(table1)
```

These numerical results summarize the percentages of males who became infected with COVID-19 after receiving either the placebo or the vaccine. Among those who contracted COVID-19, 73.80% had taken the placebo, while only 26.20% had taken the vaccine, indicating a noticeable reduction in infections among vaccinated individuals. For the males who remained healthy, the percentages were nearly evenly split: 50.01% of the placebo group and 49.99% of the vaccine group were not infected. Overall, these results suggest that the vaccine is effective for males, as the proportion of infections is much lower among those who received the vaccine compared with the placebo group.

### Inferential

```{r}
chisq.test(table1)
chisqtestGC(table1)
Msfish <- fisher.test(table1)
Msfish
```

The test produced an extremely small p-value (< 2.2×10⁻¹⁶), which is effectively zero. Such a tiny p-value indicates that the observed differences are highly unlikely to be due to chance alone.

As a result, we have strong evidence to reject the null hypothesis that COVID-19 infection status is independent of treatment group. In other words, infection rates differ significantly between the placebo and vaccine groups.

The estimated odds ratio is 2.82, meaning that individuals who received the placebo were nearly three times more likely to become infected with COVID-19 compared to those who received the vaccine. This represents a substantial difference and provides strong evidence that the vaccine is effective.

```{r}
effect <- Msfish$p.value/(Msfish$p.value +1)
effectivenessM = Msfish$estimate/(Msfish$estimate +1)*100
print(effectivenessM)
```

```{r}
low=(Msfish$conf.int[1]/(Msfish$conf.int[1] +1))*100
hi=(Msfish$conf.int[2]/(Msfish$conf.int[2] +1))*100
options(digits=2)
```

The results above show the estimated effectiveness of the COVID-19 vaccine for males. Since an effectiveness value above 50% indicates that the vaccine provides meaningful protection, the values calculated here suggest that the vaccine is effective in reducing the risk of COVID-19 infection among males.

The odds ratio provides another way to express vaccine effectiveness. For males, the estimated effectiveness is about 73.8%, and the corresponding confidence interval ranges from approximately 68.85% to 78.32%. This interval indicates that, with high confidence, the vaccine offers substantial protection.

## Females

### Barplot

```{r}
dd2 <- F %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

The first bar graph presents the number of females who got Covid-19 versus those who did not, separated by whether they received the vaccine or the placebo. The second graph shows the percentage of females in each group—whether they were infected or not—based on whether they took the vaccine or the placebo.

From the plot, about 65% of the females who contracted Covid-19 had received the placebo, while about 35% had received the vaccine. Among the females who did not contract Covid-19, the distribution is close to 50/50 between the vaccine and placebo groups. Compared to male participants, this suggests that fewer females contracted Covid-19 with the placebo, and more contracted Covid-19 with the vaccine. Still, the same general pattern appears: the placebo group shows a higher infection rate than the vaccine group.

The R code used to create the barplot begins with the line starting with dd2. The dd2 dataset includes four variables: treatment, infected, count, and prcnt (percentage). The first graph is generated using the code labeled basicC, which uses the 11 variables stored in the environment panel. The final block of code—also named basicCC—uses these variables to create the percentage barplot shown in the second graph.

### Numerical 

```{r}
table1 <- xtabs(~infected + treatment, data=F)
rowPerc(table1)
colPerc(table1)
```

Among the females who became infected, 65% had taken the placebo, while only 35% had received the vaccine. For those who did not get Covid-19, the percentages were evenly split with 50% taking the placebo and 50% taking the vaccine. These findings indicate that the Covid-19 vaccine was effective for females, as a smaller proportion of vaccinated women contracted the virus compared to those who received the placebo. This difference is notable and highlights the vaccine’s impact.

### Inferential 

```{r}
chisq.test(table1)
chisqtestGC(table1)
Fsfish <- fisher.test(table1)
Fsfish
```

The most important part of these results comes from the Fisher’s Exact Test. The p-value is extremely small—close to 0—which means that the results are very unlikely to be due to chance.

Because of this, we can reject the null hypothesis. In other words, being infected with Covid-19 is not independent of the treatment group. The treatment someone received (placebo or vaccine) is related to whether they got Covid-19.

The odds ratio is 1.9, meaning that females who took the placebo were almost twice as likely to get Covid-19 compared to those who received the vaccine. This is a meaningful difference and supports the conclusion that the vaccine is likely effective.

## LGBTQ



## Druggies


# Overall Results and Conclusions